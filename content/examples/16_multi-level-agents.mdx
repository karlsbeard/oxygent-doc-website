---
title: Multi-Level Agents
description: Demonstrates hierarchical multi-level agent architecture in OxyGent
---

## Overview

This example demonstrates how to build a multi-level (hierarchical) agent system in OxyGent with 3 levels:
- Level 1: Master agent coordinating everything
- Level 2: QA agent and note agent
- Level 3: Time agent and file agent

## Code

```python
import os
from oxygent import MAS, oxy, Config
from pydantic import Field

Config.set_agent_llm_model("default_llm")

jd_docs_fh = oxy.FunctionHub(name="jd_docs_tools")

@jd_docs_fh.tool(description="A tool that can retrieve JD-related knowledge")
def retrieval(query: str = Field(description="What aspect of knowledge")) -> str:
    """The following uses character matching for simulation. In production environments, typically retrieve top-K relevant content from knowledge base based on query, and can add multi-path retrieval logic"""
    knowledage_dict = {
        "211_delivery": "**JD 211 Delivery Service**: Orders placed before 11:00 AM (or 10:00 AM in some cities) are delivered the same day; orders placed before 11:00 PM are delivered by 3:00 PM the next day. (Note: Timing starts from order submission for in-stock orders, and from payment completion for prepaid orders)",
        "mission": "JD's mission is 'Technology for a Better Life'.",
        "vision": "JD's vision is to become the world's most trusted company.",
        "values": "JD's core values are: Customer First, Innovation, Fighting Spirit, Responsibility, Gratitude, and Integrity.",
    }
    return "\n\n".join([v for k, v in knowledage_dict.items() if k in query])

note_prompt = """
You are an assistant that helps users take notes, format as follows:
[June 18, 2025 10:00] Location Meeting
[November 11, 2025 Evening] On Duty
You should first get the time using Shanghai timezone, then record to note.txt file in local_file folder, create if file doesn't exist.

You can use these tools:
${tools_description}

Choose appropriate tools based on user's question.
If no tools needed, reply directly.
If answering user's question requires multiple tool calls, call one tool at a time, user will give you feedback on tool call results.

Important:
1. When you have enough information to answer user's question, please respond in the following format:
<think>Your thinking (if analysis needed)</think>
Your answer content
2. When you find the user's question lacks conditions, you can ask back, please respond in the following format:
<think>Your thinking (if analysis needed)</think>
Your question to the user
3. When you need to use a tool, you must only respond with the exact JSON object format below, nothing else:
(JSON format with think, tool_name, and arguments fields)

After receiving tool response:
1. Convert raw data to natural conversational response
2. Answer should be concise but informative
3. Focus on most relevant information
4. Use appropriate context from user's question
5. Avoid simply repeating raw data

Please only use the tools explicitly defined above.
"""

oxy_space = [
    oxy.HttpLLM(
        name="default_llm",
        api_key=os.getenv("DEFAULT_LLM_API_KEY"),
        base_url=os.getenv("DEFAULT_LLM_BASE_URL"),
        model_name=os.getenv("DEFAULT_LLM_MODEL_NAME"),
        llm_params={"temperature": 0.1},
    ),
    jd_docs_fh,
    oxy.StdioMCPClient(
        name="time_tools",
        params={
            "command": "uvx",
            "args": ["mcp-server-time", "--local-timezone=Asia/Shanghai"],
        },
    ),
    oxy.StdioMCPClient(
        name="file_tools",
        params={
            "command": "npx",
            "args": ["-y", "@modelcontextprotocol/server-filesystem", "./local_file"],
        },
    ),
    oxy.ReActAgent(   # Level 2 agent
        name="QA_agent",
        desc="An assistant that can query JD knowledge",
        tools=["jd_docs_tools"],
    ),
    oxy.ReActAgent(   # Level 3 agent
        name="time_agent",
        desc="An assistant that can query time",
        tools=["time_tools"],
    ),
    oxy.ReActAgent(   # Level 3 agent
        name="file_agent",
        desc="An assistant that can operate files",
        tools=["file_tools"],
    ),
    oxy.ReActAgent(   # Level 2 agent
        name="note_agent",
        desc="A life assistant that takes notes",
        prompt=note_prompt,
        sub_agents=["time_agent", "file_agent"],
    ),
    oxy.ReActAgent(   # Level 1 agent
        name="master_agent",
        is_master=True,
        sub_agents=["QA_agent", "note_agent"],
    ),
]

async def main():
    async with MAS(oxy_space=oxy_space) as mas:
        await mas.start_web_service(first_query="Help me create a reminder: meeting at 3 PM in room 618")

if __name__ == "__main__":
    import asyncio
    asyncio.run(main())
```

## Key Points

- **3-Level Architecture**: Master agent (L1) → QA/Note agents (L2) → Time/File agents (L3)
- **Hierarchical Coordination**: Upper-level agents can delegate tasks to sub-agents
- **Global LLM Configuration**: Use `Config.set_agent_llm_model()` to set default LLM for all agents
- **Custom Prompt**: The note agent has a custom prompt defining its behavior and tool usage

## Agent Hierarchy

```
master_agent (L1)
├── QA_agent (L2)
│   └── jd_docs_tools
└── note_agent (L2)
    ├── time_agent (L3)
    │   └── time_tools
    └── file_agent (L3)
        └── file_tools
```

## Running the Example

To run this example:

```bash
python 16_multi_level_agents.py
```

The example creates a note at the specified time using hierarchical agent coordination.
